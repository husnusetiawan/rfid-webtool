function executeAjax(url,params,callback){var xhr=new XMLHttpRequest;xhr.open("post",url),xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xhr.onreadystatechange=function(){4===xhr.readyState&&callback(xhr.status)},xhr.send(params)}function RwtUi(rwt){document.write("<div id=\"widget-rwt-ui\" style=\"display:flex;position:fixed;bottom:0;right:0;background:#E3E2E2;padding:5px\"><div id='widget-rwt-ui-content'></div><button id='widget-rwt-ui-connect'>Connect</button></div>"),document.write("<style>#widget-rwt-ui{font-family: Georgia, serif;font-size:11px}</style>"),document.write("<style>#widget-rwt-ui-content .state-1{color:#64B762}</style>"),document.write("<style>#widget-rwt-ui-content .state-0{color:#CD4A4C}</style>"),document.getElementById("widget-rwt-ui-connect").onclick=(()=>{let ip_address=document.getElementById("widget-rwt-ui-connect-ip-address").value;rwt.setClientIp(ip_address),rwt.connect()});rwt.onUiUpdate=(()=>{document.getElementById("widget-rwt-ui-content").innerHTML=" Status: <b class='state-"+rwt.state+"'>"+rwt.getStatus()+"</b>  Device: <input type='text' style='width:100px' id='widget-rwt-ui-connect-ip-address' value='"+rwt.lastClientIp+"' />"})}function RwtClass(){this.CONNECTED=1,this.CONNECTING=2,this.NOT_CONNECTED=0;this.connection=null,this.lastClientIp=localStorage.getItem("rwt-client-ip",""),this.state=0;var readData=[],writeCallback=null,readSectorCallback=null,readCallback=null;this.initWidget=(()=>{RwtUi(this)}),this.connect=(()=>{var CONNECTING=this.CONNECTING,CONNECTED=this.CONNECTED,NOT_CONNECTED=this.NOT_CONNECTED,self=this;let lastClientIp=this.lastClientIp;if(!lastClientIp)return this.lastClientIp="",void self.onUiUpdate();null!=this.connection&&1==this.connection.readyState&&this.connection.close(),connection=new WebSocket("ws://"+lastClientIp+":81/",["arduino"]),self.state=CONNECTING,self.onStateChange(self.state),self.onUiUpdate();var connectingTimer=setTimeout(()=>{self.state==CONNECTING&&connection.close()},3e3);connection.onopen=(()=>{self.state=CONNECTED,self.onStateChange(self.state),self.onUiUpdate(),clearTimeout(connectingTimer)}),connection.onmessage=(event=>{let data_arr=event.data.split(":");if(-1!=data_arr[0].indexOf("SECTOR")){let key=parseInt(data_arr[0].replace("SECTOR","")),number=key>10?key-9:key-8,data=data_arr[1];return readData[number]=data,void(readSectorCallback&&readSectorCallback(number,data))}if("CARD"==data_arr[0]){let data=data_arr[1];return readCallback("valid"==data,readData),void(readData=[])}if("WRITE"==data_arr[0]){let data=data_arr[1];writeCallback("1"==data)}}),connection.onclose=(()=>{self.state=NOT_CONNECTED,self.onStateChange(self.state),self.onUiUpdate(),clearTimeout(connectingTimer)}),this.connection=connection}),this.write=((params,readyCallback,successCallback)=>{writeCallback=successCallback;params="block8="+encodeURI(params[0])+"&block9="+encodeURI(params[1])+"&block10="+encodeURI(params[2])+"&block12="+encodeURI(params[3])+"&block13="+encodeURI(params[4]);executeAjax("http://"+this.lastClientIp+"/write",params,status=>{readyCallback(200==status)})}),this.read=((callback,sectorCallback)=>{readCallback=callback,readSectorCallback=sectorCallback}),this.setClientIp=(ip=>(localStorage.setItem("rwt-client-ip",ip),this.lastClientIp=ip,ip)),this.getStatus=(()=>this.state==this.CONNECTING?"Connecting":this.state==this.CONNECTED?"Connected":this.state==this.NOT_CONNECTED?"Not Connected":void 0),this.onStateChange=(state=>{}),this.onUiUpdate=(state=>{})}var Rwt=new RwtClass;